name: Publish Github

on:
  workflow_call:

jobs:
  main:
    runs-on: ubuntu-latest
    steps:
      - name: Download Artifact
        uses: actions/download-artifact@v2
        with:
          name: cosmoflex-build

      - name: Setup NodeJS
        uses: actions/setup-node@v2
        with:
          node-version: lts/*
          registry-url: https://npm.pkg.github.com/
      - name: Set NODE_AUTH_TOKEN
        run: export NODE_AUTH_TOKEN=${{ secrets.GIT_TOKEN }}
      # - name: Config .yarnrc.yml
      #   run: |
      #     echo "npmRegistries:" > ~/.yarnrc.yml
      #     echo "\"https://registry.yarnpkg.com\":" >> ~/.yarnrc.yml
      #     echo "npmAlwaysAuth: true" >> ~/.yarnrc
      #     echo "\"https://npm.pkg.github.com\"" >> ~/.yarnrc.yml
      #     echo "npmAuthToken: \"${{secrets.GIT_TOKEN}}\"" >> ~/.yarnrc.yml
      #     echo "npmAlwaysAuth: true" >> ~/.yarnrc.yml
      #     echo "npmScopes:" >> ~/.yarnrc.yml
      #     echo "cosmoui:" >> ~/.yarnrc.yml
      #     echo "npmRegistryServer: \"https://npm.pkg.github.com\"" >> ~/.yarnrc.yml

      - name: display .yarnrc
        run: cat .yarnrc

      - name: List files
        run: ls

      - name: Publish package
        run: yarn publish
        env:
          NODE_AUTH_TOKEN: ${{secrets.GIT_TOKEN}}
